<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Face Nose Filter</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    canvas, video {
      position: absolute;
      top: 0;
      left: 0;
    }
    #gif-source {
      display: none; /* hidden, but used for drawing */
    }
  </style>
</head>
<body>
  <video id="video" width="720" height="560" autoplay muted></video>
  <canvas id="overlay" width="720" height="560"></canvas>

  <!-- Hidden animated GIF image -->
  <img id="gif-source" src="./connect01.png" />

  <!-- Load face-api.js from local file or CDN -->
  <script src="face-api.js"></script>
  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('overlay');
    const context = canvas.getContext('2d');
    const gif = document.getElementById('gif-source');

    async function startCamera() {
      const stream = await navigator.mediaDevices.getUserMedia({ video: {} });
      video.srcObject = stream;
    }

    async function loadModels() {
      const MODEL_URL = './models';
      await Promise.all([
        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),
        faceapi.nets.faceLandmark68TinyNet.loadFromUri(MODEL_URL),
      ]);
    }

    video.addEventListener('play', () => {
      const displaySize = { width: video.width, height: video.height };
      faceapi.matchDimensions(canvas, displaySize);

      setInterval(async () => {
        const detections = await faceapi.detectAllFaces(
          video,
          new faceapi.TinyFaceDetectorOptions()
        ).withFaceLandmarks(true);

        context.clearRect(0, 0, canvas.width, canvas.height);

        const resized = faceapi.resizeResults(detections, displaySize);
        resized.forEach(det => {
          const nose = det.landmarks.getNose();
          const noseTip = nose[3]; // Tip of the nose

          const size = 400; // smaller size for GIF
          context.drawImage(gif, noseTip.x - size / 2, noseTip.y - size / 2, size, size);
        });
      }, 1000 / 30); // ~30 fps
    });

    // Start the whole process
    loadModels().then(startCamera);
  </script>
</body>
</html>
